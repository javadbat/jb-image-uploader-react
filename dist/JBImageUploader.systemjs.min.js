System.register(["react","mobx","jb-modules/RequestModule/dist/UploadFileRequest.cjs.min","react-dom","./JBImageUploader.css!","mobx-react"],function(a){'use strict';var b,c,d,e,f,g,h;return{setters:[function(a){b=a.default},function(a){c=a.extendObservable,d=a.observable,e=a.computed},function(a){f=a.default},function(a){g=a.default},function(){},function(a){h=a.observer}],execute:function(){function i(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function l(a,b,c){return b&&k(a.prototype,b),c&&k(a,c),a}function m(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function n(a){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n(a)}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function p(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function q(a,b,c){return b&&p(a.prototype,b),c&&p(a,c),a}function r(a,b){return b&&("object"===n(b)||"function"==typeof b)?b:s(a)}function s(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function t(a){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},t(a)}function u(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&v(a,b)}function v(a,b){return v=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},v(a,b)}var w,x,y,z,A,B,C,D,E=(w=(C=function(){function a(b){var c=this;j(this,a),this.defaultConfig={urls:{showImage:"",uploadImage:""},deletable:!1,JBImageEditorConfig:{callBacks:{onClose:function(){return c.onImageEditorClosed()},onApprove:function(a){return c.onImageEditorApproved(a)}}},triggers:{lock:function(a){c.lock(a)},unlock:function(){c.unlock()},reUploadImage:function(){c.uploadImage()}},acceptType:"image/jpeg,image/jpg,image/png",openImageEditorCondition:function(a){return!0==a.ctrlKey}},this.config=null,i(this,"progressPercent",x,this),i(this,"status",y,this),this.useImageEditor=!1,this.virtualInputFile=void 0,this.selectedImageType=void 0,this.elements={imageEditorDOM:null},i(this,"value",z,this),i(this,"isLock",A,this),i(this,"lockText",B,this),this.inUploadImageFile=null,this.props=b,this.value=b.value,this.config=this.mergeObject(b.config,this.defaultConfig),this.createVirtualInputFile(),this.value&&(this.status="has_value")}return l(a,[{key:"mergeObject",value:function(a,b){var d={};for(var e in b)(null==a[e]||null==a[e])&&(d[e]=b[e]);return c(a,d),a}},{key:"createVirtualInputFile",value:function(){var a=this;this.virtualInputFile=document.createElement("input"),this.virtualInputFile.type="file",this.virtualInputFile.accept=this.config.acceptType,this.virtualInputFile.addEventListener("change",function(b){return a.onImageSelected(b)})}},{key:"openSelectImageDialog",value:function(a){var b;b="function"==typeof this.config.openImageEditorCondition?this.config.openImageEditorCondition.call(this,a):this.config.openImageEditorCondition,b&&(this.useImageEditor=!0),a.target.closest(".action-bar")||("empty"==this.status||"has_value"==this.status)&&this.virtualInputFile.click()}},{key:"onImageSelected",value:function(a){0<a.target.files.length&&(this.config.JBImageEditorConfig&&this.useImageEditor?(this.selectedImageType=a.target.files[0].type,this.initImageEditor(a.target.files[0])):(this.inUploadImageFile=a.target.files[0],this.uploadImage(),this.useImageEditor=!1,this.selectedImageType=a.target.files[0].type))}},{key:"uploadImage",value:function(){var a=this;this.status="updating";new f({url:this.config.urls.uploadImage,file:this.inUploadImageFile,onSuccess:function(b){return a.onSuccessImageUpload(b)},onError:function(b){return a.onErrorImageUpload(b)},onProgress:function(b){return a.onProgressImageUpload(b)}})}},{key:"onSuccessImageUpload",value:function(a){this.props.onSuccess&&this.props.onSuccess(a)}},{key:"onErrorImageUpload",value:function(a){this.status=this.props.value?"has_value":"empty",this.virtualInputFile.value="",this.props.onError&&this.props.onError(a)}},{key:"onProgressImageUpload",value:function(a){this.progressPercent=a,this.props.onProgress&&this.props.onProgress(a)}},{key:"onDeleteImageBtnClicked",value:function(a){this.props.onDelete&&this.props.onDelete(a)}},{key:"initImageEditor",value:function(a){var c=this;this.elements.imageEditorDOM=document.createElement("div"),this.elements.imageEditorDOM.classList.add("jb-image-editor-float-container");var d=document.getElementsByTagName("body");d[0].appendChild(this.elements.imageEditorDOM),System.import("ReactComponents/JBImageEditor/JBImageEditor.js").then(function(d){var e=d.default;g.render(b.createElement(e,{config:c.config.JBImageEditorConfig,imageFile:a}),c.elements.imageEditorDOM,c.onImageEditorLoadComplete())})}},{key:"onImageEditorLoadComplete",value:function(){}},{key:"onImageEditorClosed",value:function(){this.virtualInputFile.value="",this.elements.imageEditorDOM.parentNode.removeChild(this.elements.imageEditorDOM),this.elements.imageEditorDOM=null}},{key:"onImageEditorApproved",value:function(a){var b=this.dataURItoBlob(a);this.uploadImage(b),this.useImageEditor=!1,this.virtualInputFile.value="",this.elements.imageEditorDOM.parentNode.removeChild(this.elements.imageEditorDOM),this.elements.imageEditorDOM=null}},{key:"dataURItoBlob",value:function(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:this.selectedImageType})}},{key:"lock",value:function(a){"string"==typeof a&&(this.lockText=a),this.isLock=!0}},{key:"unlock",value:function(){this.isLock=!1}},{key:"getPreviewImageURL",get:function(){return this.value?this.config.urls.showImage.replace("{value}",this.value):null}}]),a}(),C),x=m(w.prototype,"progressPercent",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y=m(w.prototype,"status",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"empty"}}),z=m(w.prototype,"value",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),A=m(w.prototype,"isLock",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B=m(w.prototype,"lockText",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Lock"}}),m(w.prototype,"getPreviewImageURL",[e],Object.getOwnPropertyDescriptor(w.prototype,"getPreviewImageURL"),w.prototype),w),F=h(D=function(a){function c(a){var b;return o(this,c),b=r(this,t(c).call(this,a)),b.service=new E(a),b.service.props=b.props,b}return u(c,a),q(c,[{key:"componentWillReceiveProps",value:function(a){this.service.value!=a.value&&(this.service.value=a.value,this.service.status=a.value?"has_value":"empty")}},{key:"render",value:function(){var a=this,c=b.createElement("div",{className:"jb-image-uploader-component"},b.createElement("section",{className:"bg-wrapper "+("empty"==this.service.status?"":"hide"),onClick:function(b){return a.service.openSelectImageDialog(b)}},b.createElement("div",{className:"icon-wrapper"},b.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 308.8 308.8"},b.createElement("g",null,b.createElement("path",{style:{fill:"#4A566E"},d:"M35.6,18.8h180c19.6,0,35.6,16,35.6,35.6v185.2c0,19.6-16,35.6-35.6,35.6h-180   C16,275.2,0,259.2,0,239.6V54C0,34.8,16,18.8,35.6,18.8z"}),b.createElement("path",{style:{fill:"#00B594"},d:"M116.4,186.4l-52.8-52.8L0,197.2v13.2v28.8c0,19.6,16,35.6,35.6,35.6h180c19.6,0,35.6-16,35.6-35.6   v-28.8v-39.6l-59.6-60L116.4,186.4z"}),b.createElement("circle",{style:{fill:"#FFCC03"},cx:"114.8",cy:"103.6",r:"22.4"}),b.createElement("circle",{style:{fill:"#FFFFFF"},cx:"251.2",cy:"232.4",r:"57.6"})),b.createElement("g",null,b.createElement("path",{style:{fill:"#00B594"},d:"M242.8,205.6c0-4.8,3.6-8.4,8.4-8.4c4.4,0,8.4,3.6,8.4,8.4V260c0,4.8-3.6,8.4-8.4,8.4   s-8.4-3.6-8.4-8.4V205.6z"}),b.createElement("path",{style:{fill:"#00B594"},d:"M245.2,211.2c-3.2-3.2-3.2-8.4,0-11.6s8.4-3.2,11.6,0l19.2,19.2c3.2,3.2,3.2,8.4,0,11.6   s-8.4,3.2-11.6,0L245.2,211.2z"}),b.createElement("path",{style:{fill:"#00B594"},d:"M245.2,199.6c3.2-3.2,8.4-3.2,11.6,0s3.2,8.4,0,11.6L238,230.4c-3.2,3.2-8.4,3.2-11.6,0   s-3.2-8.4,0-11.6L245.2,199.6z"})))),b.createElement("div",{className:"caption"},"\u062A\u0635\u0648\u06CC\u0631\u06CC \u0627\u0646\u062A\u062E\u0627\u0628 \u0646\u0634\u062F\u0647 \u0627\u0633\u062A \u0628\u0631\u0627\u06CC \u0627\u0646\u062A\u062E\u0627\u0628 \u062A\u0635\u0648\u06CC\u0631 \u06A9\u0644\u06CC\u06A9 \u06A9\u0646\u06CC\u062F")),b.createElement("section",{className:"image-wrapper "+("has_value"==this.service.status?"":"hide"),onClick:function(b){return a.service.openSelectImageDialog(b)}},this.service.getPreviewImageURL&&b.createElement("img",{className:"image-showcase",src:this.service.getPreviewImageURL}),b.createElement("div",{className:"action-bar"},this.service.config.deletable&&b.createElement("div",{className:"delete-image-btn",onClick:function(b){return a.service.onDeleteImageBtnClicked(b)}},b.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 512 512",space:"preserve"},b.createElement("g",null,b.createElement("g",null,b.createElement("path",{className:"door",d:"M381.621,65.523h-53.943V54.004C327.678,24.226,303.451,0,273.673,0h-35.346c-29.778,0-54.005,24.226-54.005,54.004    v11.519h-53.943c-34.76,0-63.04,28.28-63.04,63.04v15.975H444.66v-15.976C444.66,93.803,416.38,65.523,381.621,65.523z     M297.261,65.523H214.74V54.004c0-13.005,10.581-23.587,23.588-23.587h35.346c13.006,0,23.588,10.581,23.588,23.587V65.523z"}))),b.createElement("g",null,b.createElement("g",null,b.createElement("path",{d:"M88.452,174.955v306.112c0,17.056,13.877,30.933,30.934,30.933h273.227c17.057,0,30.934-13.877,30.934-30.933V174.955    H88.452z M197.532,466.16h-30.417V220.795h30.417V466.16z M271.208,466.16h-30.417V220.795h30.417V466.16z M344.886,466.16    h-30.417V220.795h30.417V466.16z"}))))))),b.createElement("section",{className:"progress-bg-wrapper "+("updating"==this.service.status?"":"hide")},"\u062F\u0631 \u062D\u0627\u0644 \u0622\u067E\u0644\u0648\u062F"),b.createElement("section",{className:"progress-wrapper "+("updating"==this.service.status?"":"hide"),style:{width:this.service.progressPercent+"%"}}),b.createElement("section",{className:"lock-panel-wrapper "+(this.service.isLock?"":"hide")},this.service.lockText));return c}}]),c}(b.Component))||D;a("default",F)}}});
